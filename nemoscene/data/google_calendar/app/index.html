<!DOCTYPE html>
<html>
<head>
    <script src="http://linfinitysmartmirror.local:1337/bundle/silvertree/lib/lib.js"></script>
    <script src="http://linfinitysmartmirror.local:1337/bundle/google_calendar/lib/ical.min.js"></script>
</head>
<body>
<p>Calendar</p>
<div id="calendar_container"></div>

<script type="text/javascript">
    Silvertree.serverAddress = "http://linfinitysmartmirror.local:1337";
    Silvertree.initFramework("google_calendar");

    function getRequest(url, params) {
        let request = new XMLHttpRequest();
        var reqUri = url;

        var i = 0;
        for (const [key, value] of Object.entries(params)) {
            if(i === 0) {
                reqUri += "?";
            } else {
                reqUri += "&";
            }

            reqUri += encodeURIComponent(key);
            reqUri += "=";
            reqUri += encodeURIComponent(value);

            i++;
        }

        request.open("GET", reqUri, false);
        request.setRequestHeader('Content-type', 'application/x-www-form-urlencoded');
        request.send(null);
        if(request.status === 200) {
            return request.responseText;
        } else {
            return false;
        }
    }

    var calLink = Silvertree.getConfigurationValue("calendars", "private");
    fetch(calLink, { mode: 'no-cors'}).then((value) => {
        alert("Got respo");
        value.text().then((text) => {
            alert(text);
            document.getElementById("calendar_container").innerHTML = text;
        })
    });


</script>
</body>
</html>